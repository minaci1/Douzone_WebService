<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width= , initial-scale=1.0" />
    <title>Document</title>
    <!-- CSS only -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <!-- JavaScript Bundle with Popper -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <style>
      * {
        box-sizing: border-box;
      }
      .main {
        margin-top: 60px;
        text-align: center;
      }
      .table {
        margin-top: 60px;
      }
    </style>
  </head>
  <body>
    <div class="header"></div>
    <div class="main">
      <h1>서울특별시 광진구 흡연구역정보</h1>

      <table class="table">
        <thead>
          <tr>
            <th scope="col">연번</th>
            <th scope="col">구분</th>
            <th scope="col">시설명</th>
            <th scope="col">실외 / 실내</th>
            <th scope="col">영업소재지(도로명)</th>
            <th scope="col">흡연실 형태</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>
      <div class="par">
        <div class="btn-group">
          <button class="btn btn-primary" id="prev" style="margin-right: 10px">
            prev
          </button>
          <button class="btn btn-primary" id="next" style="margin-left: 10px">
            next
          </button>
        </div>
      </div>
    </div>
    <div class="footer"></div>
    <script>
      fetch("Ex49_total_Quiz.json")
        .then((response) => response.json())
        .then((data) => {
          localStorage.setItem("data", JSON.stringify(data));
        });
      let data = JSON.parse(localStorage.getItem("data"));

      let totcnt = data.data.length; //전체페이지
      let pagecnt = parseInt(data.data.length / 10); //몫
      let remainData = data.data.length % 10; //나머지
      let index = 0;
      let item = "";
      let cnt = 0;
      if (pagecnt > 0 || remainData > 0) index = 10;
      else if (pagecnt > 0 || remainData == 0) index = 10;
      else if (pagecnt == 0 || remainData > 0) index = remainData;
      else index = 0;

      //갯수가 10 나눠 10 - 1 0, 18 1 8, 8 0 8, 0 0

      for (let i = 0; i < index; i++) {
        let num = data.data[i].연번;
        let divi = data.data[i].구분;
        let name = data.data[i].시설명;
        let facility = data.data[i].실외실내;
        let location = data.data[i].영업소소재지;
        let type = data.data[i].흡연실형태;

        item += `
              <tr>
                <th scope="row">${num}</th>
                <td>${divi}</td>
                <td>${name}</td>
                <td>${facility}</td>
                <td>${location}</td>
                <td>${type}</td>
              </tr>`;
      }
      totcnt -= index;
      document.getElementsByTagName("tbody")[0].innerHTML = item;

      document.getElementById("next").addEventListener("click", function () {
        //10부터 시작
        //let data = JSON.parse(localStorage.getItem("data"));

        console.log("index : " + index); //
        console.log("totcnt:" + totcnt); //전체페이지
        if (totcnt <= 0) {
          //몫이 있고 나머지가 있으면 index +=10
          //258페이지까지...
          alert("마지막입니다.");
          return;
        } else {
          item = "";

          cnt = totcnt - 10 > 0 ? 10 : totcnt; //cnt = totcnt가 0보다 크면 10 아니면 tocnt

          for (let j = 0; j < cnt; j++) {
            let num = data.data[j + index].연번;
            let divi = data.data[j + index].구분;
            let name = data.data[j + index].시설명;
            let facility = data.data[j + index].실외실내;
            let location = data.data[j + index].영업소소재지;
            let type = data.data[j + index].흡연실형태;

            item += `
              <tr>
                <th scope="row">${num}</th>
                <td>${divi}</td>
                <td>${name}</td>
                <td>${facility}</td>
                <td>${location}</td>
                <td>${type}</td>
              </tr>`;
          }
          document.getElementById("tbody").innerHTML = "";
          document.getElementById("tbody").innerHTML = item;
          index += cnt;
          totcnt -= cnt;
          console.log("index 2: " + index); //
          console.log("totcnt2:" + totcnt); //전체페이지
        }
      });

      document.getElementById("prev").addEventListener("click", function () {
        if (index > 0) {
          index -= cnt;
          totcnt += cnt;
        }
        console.log("index 3: " + index); //         20
        console.log("totcnt3:" + totcnt); //전체페이지 248
        cnt = index - 10 > 0 ? index - 10 : 0;
        if (cnt == 0 && index > 0) cnt = 10; //첫페이지용
        if (index <= 0) {
          alert("처음입니다.");
          return;
        } else {
          item = "";
          for (let j = 0; j < cnt; j++) {
            let num = data.data[index - cnt + j].연번;
            let divi = data.data[index - cnt + j].구분;
            let name = data.data[index - cnt + j].시설명;
            let facility = data.data[index - cnt + j].실외실내;
            let location = data.data[index - cnt + j].영업소소재지;
            let type = data.data[index - cnt + j].흡연실형태;

            item += `
              <tr>
                <th scope="row">${num}</th>
                <td>${divi}</td>
                <td>${name}</td>
                <td>${facility}</td>
                <td>${location}</td>
                <td>${type}</td>
              </tr>`;
          }
          document.getElementById("tbody").innerHTML = "";
          document.getElementById("tbody").innerHTML = item;
          index -= cnt;
          totcnt += cnt;
          console.log("index 4: " + index); //          10
          console.log("totcnt4:" + totcnt); //전체페이지 258
        }
      });
    </script>
  </body>
</html>
